from abc import ABC, abstractmethod

class AbstractCourse(ABC):
    @abstractmethod
    def create_course(self, name, code, credit_hours=3, max_students=25, priority="Normal"):
        pass

    @abstractmethod
    def enroll_student(self):
        pass

    @abstractmethod
    def show_course(self):
        pass


class Course(AbstractCourse):
    def create_course(self, name, code, credit_hours=3, max_students=25, priority="Normal"):
        self.name = name
        self.code = code
        self.credit_hours = credit_hours
        self.max_students = max_students
        self.enrolled_students = 0
        self.priority = priority
        self.attendance = {}

    def enroll_student(self):
        if self.enrolled_students < self.max_students:
            self.enrolled_students += 1
            return True
        else:
            print(f"Alert: {self.name} is full.")  # Alert if the course is full
            return False

    def mark_attendance(self, student_id, present=True):
        if student_id not in self.attendance:
            self.attendance[student_id] = []
        self.attendance[student_id].append(present)

    def show_attendance(self):
        return self.attendance

    def show_course(self):
        return f"{self.name} ({self.code}), Priority: {self.priority}, Credit Hours: {self.credit_hours}, Enrolled: {self.enrolled_students}/{self.max_students}"


class Student:
    id_counter = 1
    ID_PREFIX = "UOB-"
    def __init__(self):
        self.id = None
        self.name = None
        self.classes = []
        self.__grades = {}
        self.activity_log = []
        self.max_classes = 5

    def set_student(self, name):
        self.id = f"{Student.ID_PREFIX}{Student.id_counter:04d}"
        Student.id_counter += 1
        self.name = name
        self.__grades = {}

    def enroll_in_class(self, course):
        # Check for schedule conflicts
        for existing_course in self.classes:
            if existing_course == course:
                return f"Error: Conflict with {existing_course.name}."

        if len(self.classes) >= self.max_classes:
            return "Error: You have reached the maximum number of classes."
        elif course.code in [c.code for c in self.classes]:
            return f"Error: You are already enrolled in {course.code}."
        else:
            success = course.enroll_student()
            if success:
                self.classes.append(course)
                self.log_activity(f"Enrolled in {course.name}.")
                return f"Successfully enrolled in {course.name}!"
            else:
                return f"Error: {course.name} is full."

    def log_activity(self, activity):
        self.activity_log.append(activity)

    def show_activity_log(self):
        return "\n".join(self.activity_log)

    def drop_class(self, course_code):
        for course in self.classes:
            if course.code == course_code:
                self.classes.remove(course)
                course.enrolled_students -= 1
                self.log_activity(f"Dropped {course.name}.")
                return f"Successfully dropped {course.name}."
        return "Error: Course not found."

    def show_student(self):
        enrolled_courses = ', '.join([course.code for course in self.classes])
        return (f"ID: {self.id}, Name: {self.name}, Enrolled Classes: {enrolled_courses}")
    def __repr__(self):
        return f"{self.name}, id is {self.id}"


class Schedule:
    def create_schedule(self):
        self.courses = {
            "Sunday": [Course(), Course(), Course(), Course()],
            "Monday": [Course(), Course(), Course(), Course()],
            "Tuesday": [Course(), Course(), Course(), Course()],
            "Wednesday": [Course(), Course(), Course(), Course()]
        }
        self.schedule_times = ["8:30 AM - 10:30 AM", "10:30 AM - 12:30 PM", "12:30 PM - 2:30 PM", "2:30 PM - 4:30 PM"]

        # Add courses to the schedule
        self.courses["Sunday"][0].create_course("Data Structures", "CS101", priority="High")
        self.courses["Sunday"][1].create_course("AI", "CS102")
        self.courses["Sunday"][2].create_course("Web Development", "CS103")
        self.courses["Sunday"][3].create_course("Mathematics", "CS104")
        self.courses["Monday"][0].create_course("Machine Learning", "CS105")
        self.courses["Monday"][1].create_course("Cyber Security", "CS106")
        self.courses["Monday"][2].create_course("Cloud Computing", "CS107")
        self.courses["Monday"][3].create_course("Game Development", "CS108")
        self.courses["Tuesday"][0].create_course("Databases", "CS109")
        self.courses["Tuesday"][1].create_course("Networks", "CS110")
        self.courses["Tuesday"][2].create_course("Operating Systems", "CS111")
        self.courses["Tuesday"][3].create_course("Algorithms", "CS112")
        self.courses["Wednesday"][0].create_course("Software Engineering", "CS113")
        self.courses["Wednesday"][1].create_course("Web Design", "CS114")
        self.courses["Wednesday"][2].create_course("Mobile Apps", "CS115")
        self.courses["Wednesday"][3].create_course("Big Data", "CS116")

    def display_schedule(self, day):
        schedule_str = f"Schedule for {day}:\n"
        courses = self.courses.get(day, [])

        if courses:
            for i in range(len(courses)):
                time = self.schedule_times[i]
                course = courses[i]
                schedule_str += f"{time}: {course.show_course()}\n"
        else:
            schedule_str += "No courses available.\n"

        return schedule_str

    def set_holiday(self, day):
        if day in self.courses:
            self.courses[day] = []
            return f"Holiday set for {day}."
        return "Invalid day."

    def __getitem__(self, time):
        for day, courses in self.courses.items():
            for i, course in enumerate(courses):
                if self.schedule_times[i] == time:
                    return course
        return None


# Main Interface
def main_interface():
    access_code = "UOF2024-5"
    user_code = input("Enter access code: ")
    
    if user_code == access_code:
        print("Access Granted.")
        # Initialize schedule and student
        student1 = Student()
        student1.set_student("Ali")
        schedule = Schedule()
        schedule.create_schedule()
        
        # Display options
        while True:
            print("\n1. Display Full Schedule")
            print("2. Display Schedule for a Specific Day")
            print("3. Enroll in Course")
            print("4. Drop a Course")
            print("5. Show Attendance")
            print("6. Show Activity Log")
            print("7. Set Holiday")
            print("8. Exit")
            choice = input("Select an option: ")

            if choice == "1":
                print("\nFull Schedule:")
                for day in ["Sunday", "Monday", "Tuesday", "Wednesday"]:
                    print(schedule.display_schedule(day))
            elif choice == "2":
                day = input("Enter day (Sunday, Monday, ...): ")
                print(schedule.display_schedule(day))
            elif choice == "3":
                day = input("Enter day of the course: ")
                time = input("Enter time slot (e.g., 8:30 AM - 10:30 AM): ")
                course = schedule[time]
                if course:
                    print(student1.enroll_in_class(course))
                else:
                    print("Course not found.")
            elif choice == "4":
                course_code = input("Enter course code to drop: ")
                print(student1.drop_class(course_code))
            elif choice == "5":
                course_code = input("Enter course code to view attendance: ")
                for day, courses in schedule.courses.items():
                    for course in courses:
                        if course.code == course_code:
                            print(course.show_attendance())
                            break
            elif choice == "6":
                print(student1.show_activity_log())
            elif choice == "7":
                day = input("Enter day to set holiday: ")
                print(schedule.set_holiday(day))
            elif choice == "8":
                print("Exiting.")
                break
            else:
                print("Invalid choice. Please try again.")
    else:
        print("Access Denied.")

# Run the interface
main_interface()
